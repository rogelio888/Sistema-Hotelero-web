import{z as F,j as b,u as H,r as c,h as U,c as x,a as o,i as m,k as z,d as E,l as f,m as n,o as p,s as d,n as D,t as v,w as q,e as A,F as L,A as G,p as I,v as R}from"./index-CTzTmT_K.js";import{u as J}from"./hoteles-UglgslUa.js";import{_ as K}from"./Table-fkUJsl3I.js";import{_ as w}from"./Button-Dd-4xSWI.js";import{M as _}from"./Modal-ClueKbjA.js";const Q=F("pisos",{state:()=>({pisos:[],pisoActual:null,loading:!1,error:null}),getters:{totalPisos:l=>l.pisos.length},actions:{async fetchPisos(l={}){this.loading=!0,this.error=null;try{const s=new URLSearchParams(l),a=await b.get(`/pisos?${s}`);a.data.success&&(this.pisos=a.data.data)}catch(s){throw this.error=s.response?.data?.message||"Error al cargar pisos",s}finally{this.loading=!1}},async fetchPiso(l){this.loading=!0,this.error=null;try{const s=await b.get(`/pisos/${l}`);if(s.data.success)return this.pisoActual=s.data.data,s.data.data}catch(s){throw this.error=s.response?.data?.message||"Error al cargar piso",s}finally{this.loading=!1}},async createPiso(l){this.loading=!0,this.error=null;try{const s=await b.post("/pisos",l);if(s.data.success)return this.pisos.push(s.data.data),s.data}catch(s){throw this.error=s.response?.data?.message||"Error al crear piso",s}finally{this.loading=!1}},async updatePiso(l,s){this.loading=!0,this.error=null;try{const a=await b.put(`/pisos/${l}`,s);if(a.data.success){const g=this.pisos.findIndex(u=>u.id===l);return g!==-1&&(this.pisos[g]=a.data.data),a.data}}catch(a){throw this.error=a.response?.data?.message||"Error al actualizar piso",a}finally{this.loading=!1}},async deletePiso(l){this.loading=!0,this.error=null;try{const s=await b.delete(`/pisos/${l}`);if(s.data.success)return this.pisos=this.pisos.filter(a=>a.id!==l),s.data}catch(s){throw this.error=s.response?.data?.message||"Error al eliminar piso",s}finally{this.loading=!1}}}}),W={class:"flex items-center justify-between mb-6"},X={class:"flex items-center space-x-2"},Y=["onClick"],Z=["onClick"],ee={class:"space-y-4"},se=["value"],oe={class:"mt-6 flex justify-end space-x-3"},te={class:"text-gray-700"},de={__name:"Index",setup(l){const s=H(),a=Q(),g=J(),u=c(!1),y=c(!1),P=c(!1),h=c(null),k=c(!1),C=c(!1),r=c({id:null,id_hotel:"",numero:"",estado:"ACTIVO"}),$=[{key:"id",label:"ID"},{key:"numero",label:"Piso"},{key:"hotel",label:"Hotel"},{key:"estado",label:"Estado"}],S=async()=>{try{await a.fetchPisos()}catch(i){console.error("Error al cargar pisos:",i)}},M=()=>{P.value=!1,r.value={id:null,id_hotel:"",numero:"",estado:"ACTIVO"},u.value=!0},N=i=>{P.value=!0,r.value={id:i.id,id_hotel:i.id_hotel,numero:i.numero,estado:i.estado},u.value=!0},V=()=>{u.value=!1,r.value={id:null,id_hotel:"",numero:"",estado:"ACTIVO"}},T=async()=>{k.value=!0;try{P.value?await a.updatePiso(r.value.id,r.value):await a.createPiso(r.value),u.value=!1,S()}catch(i){alert(i.response?.data?.message||"Error al guardar piso")}finally{k.value=!1}},O=i=>{h.value=i,y.value=!0},j=async()=>{C.value=!0;try{await a.deletePiso(h.value.id),y.value=!1,h.value=null}catch{alert("Error al eliminar piso")}finally{C.value=!1}};return U(()=>{S(),g.fetchHoteles()}),(i,e)=>(p(),x("div",null,[o("div",W,[e[6]||(e[6]=o("div",null,[o("h1",{class:"text-3xl font-bold text-gray-800"},"Pisos"),o("p",{class:"text-gray-600 mt-1"},"Administra los pisos del hotel")],-1)),f(s).hasPermission("crear_pisos")?(p(),z(w,{key:0,onClick:M},{default:n(()=>[...e[5]||(e[5]=[d(" âž• Nuevo Piso ",-1)])]),_:1})):E("",!0)]),m(K,{columns:$,data:f(a).pisos,loading:f(a).loading},{"cell-numero":n(({item:t})=>[d(" Piso "+v(t.numero),1)]),"cell-hotel":n(({item:t})=>[d(v(t.hotel?.nombre),1)]),"cell-estado":n(({item:t})=>[o("span",{class:D(["px-2 py-1 rounded-full text-xs font-semibold",t.estado==="ACTIVO"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},v(t.estado),3)]),actions:n(({item:t})=>[o("div",X,[f(s).hasPermission("editar_pisos")?(p(),x("button",{key:0,onClick:B=>N(t),class:"text-yellow-600 hover:text-yellow-800",title:"Editar"}," âœï¸ ",8,Y)):E("",!0),f(s).hasPermission("eliminar_pisos")?(p(),x("button",{key:1,onClick:B=>O(t),class:"text-red-600 hover:text-red-800",title:"Eliminar"}," ðŸ—‘ï¸ ",8,Z)):E("",!0)])]),_:1},8,["data","loading"]),m(_,{show:u.value,onClose:V,title:P.value?"Editar Piso":"Nuevo Piso"},{default:n(()=>[o("form",{onSubmit:q(T,["prevent"])},[o("div",ee,[o("div",null,[e[8]||(e[8]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Hotel",-1)),A(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.id_hotel=t),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"},[e[7]||(e[7]=o("option",{value:"",disabled:""},"Seleccione un hotel",-1)),(p(!0),x(L,null,G(f(g).hotelesActivos,t=>(p(),x("option",{key:t.id,value:t.id},v(t.nombre),9,se))),128))],512),[[I,r.value.id_hotel]])]),o("div",null,[e[9]||(e[9]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"NÃºmero de Piso",-1)),A(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.numero=t),type:"number",min:"1",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Ej. 1"},null,512),[[R,r.value.numero]])]),o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),A(o("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.estado=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"},[...e[10]||(e[10]=[o("option",{value:"ACTIVO"},"Activo",-1),o("option",{value:"INACTIVO"},"Inactivo",-1)])],512),[[I,r.value.estado]])])]),o("div",oe,[m(w,{type:"button",variant:"secondary",onClick:V},{default:n(()=>[...e[12]||(e[12]=[d("Cancelar",-1)])]),_:1}),m(w,{type:"submit",loading:k.value},{default:n(()=>[...e[13]||(e[13]=[d("Guardar",-1)])]),_:1},8,["loading"])])],32)]),_:1},8,["show","title"]),m(_,{show:y.value,onClose:e[4]||(e[4]=t=>y.value=!1),title:"Confirmar eliminaciÃ³n"},{footer:n(()=>[m(w,{variant:"secondary",onClick:e[3]||(e[3]=t=>y.value=!1)},{default:n(()=>[...e[17]||(e[17]=[d("Cancelar",-1)])]),_:1}),m(w,{variant:"danger",onClick:j,loading:C.value},{default:n(()=>[...e[18]||(e[18]=[d("Eliminar",-1)])]),_:1},8,["loading"])]),default:n(()=>[o("p",te,[e[14]||(e[14]=d("Â¿EstÃ¡s seguro de eliminar el piso ",-1)),o("strong",null,v(h.value?.numero),1),e[15]||(e[15]=d(" del hotel ",-1)),o("strong",null,v(h.value?.hotel?.nombre),1),e[16]||(e[16]=d("?",-1))])]),_:1},8,["show"])]))}};export{de as default};
