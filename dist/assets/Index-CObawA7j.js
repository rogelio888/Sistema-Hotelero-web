import{u as F,C as T,r as b,h as z,c as u,a,i as f,k as V,d as p,l as c,m as o,e as x,p as w,F as B,A as L,b as H,v as U,q,o as d,s as r,t as l,n as j}from"./index-CTzTmT_K.js";import{u as G}from"./hoteles-UglgslUa.js";import{_ as J}from"./Table-fkUJsl3I.js";import{_ as y}from"./Button-Dd-4xSWI.js";import{M as K}from"./Modal-ClueKbjA.js";const Q={class:"flex items-center justify-between mb-6"},W={class:"bg-white rounded-lg shadow p-4 mb-6"},X={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Y=["value"],Z={class:"flex items-end"},ee={class:"text-sm"},te={key:0,class:"flex items-center space-x-2"},ae=["onClick"],se=["onClick"],oe=["onClick"],re=["onClick"],le={class:"text-gray-700"},me={__name:"Index",setup(ne){const A=q(),g=F(),v=T(),E=G(),n=b({id_hotel:"",estado:"",fecha_entrada:""}),m=b(!1),C=b(null),h=b(!1),_=[{key:"id",label:"ID"},{key:"huesped",label:"HuÃ©sped"},{key:"hotel",label:"Hotel"},{key:"fechas",label:"Fechas"},{key:"total",label:"Total"},{key:"estado",label:"Estado"}],i=async()=>{try{await v.fetchReservas(n.value)}catch(s){console.error("Error al cargar reservas:",s)}},R=()=>{n.value={id_hotel:"",estado:"",fecha_entrada:""},i()},D=s=>{A.push(`/reservas/${s}`)},O=async s=>{if(confirm(`Â¿Realizar check-in para ${s.huesped.nombre}?`))try{await v.checkIn(s.id),await i(),alert("Check-in realizado exitosamente")}catch{alert("Error al realizar check-in")}},S=async s=>{if(confirm(`Â¿Realizar check-out para ${s.huesped.nombre}?`))try{await v.checkOut(s.id),await i(),alert("Check-out realizado exitosamente")}catch(e){alert(e.response?.data?.message||"Error al realizar check-out")}},P=s=>{C.value=s,m.value=!0},$=async()=>{h.value=!0;try{await v.cancelarReserva(C.value.id),m.value=!1,await i()}catch{alert("Error al cancelar reserva")}finally{h.value=!1}},N=s=>s?new Date(s).toLocaleDateString("es-BO",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",I=s=>s==null?"-":new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB"}).format(s),M=s=>({PENDIENTE:"bg-yellow-100 text-yellow-800",CONFIRMADA:"bg-blue-100 text-blue-800",EN_PROCESO:"bg-green-100 text-green-800",COMPLETADA:"bg-gray-100 text-gray-800",CANCELADA:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800";return z(()=>{E.fetchHoteles(),i()}),(s,e)=>(d(),u("div",null,[a("div",Q,[e[7]||(e[7]=a("div",null,[a("h1",{class:"text-3xl font-bold text-gray-800"},"Reservas"),a("p",{class:"text-gray-600 mt-1"},"Administra todas las reservas del sistema")],-1)),c(g).hasPermission("crear_reservas")?(d(),V(y,{key:0,onClick:e[0]||(e[0]=t=>s.$router.push("/reservas/crear"))},{default:o(()=>[...e[6]||(e[6]=[r(" âž• Nueva Reserva ",-1)])]),_:1})):p("",!0)]),a("div",W,[a("div",X,[a("div",null,[e[9]||(e[9]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Hotel",-1)),x(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.id_hotel=t),onChange:i,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[e[8]||(e[8]=a("option",{value:""},"Todos",-1)),(d(!0),u(B,null,L(c(E).hoteles,t=>(d(),u("option",{key:t.id,value:t.id},l(t.nombre),9,Y))),128))],544),[[w,n.value.id_hotel]])]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Estado",-1)),x(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.estado=t),onChange:i,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...e[10]||(e[10]=[H('<option value="">Todos</option><option value="PENDIENTE">Pendiente</option><option value="CONFIRMADA">Confirmada</option><option value="EN_PROCESO">En Proceso</option><option value="COMPLETADA">Completada</option><option value="CANCELADA">Cancelada</option>',6)])],544),[[w,n.value.estado]])]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha Entrada",-1)),x(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.fecha_entrada=t),onChange:i,type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},null,544),[[U,n.value.fecha_entrada]])]),a("div",Z,[f(y,{variant:"secondary",onClick:R,class:"w-full"},{default:o(()=>[...e[13]||(e[13]=[r(" ðŸ”„ Limpiar ",-1)])]),_:1})])])]),f(J,{columns:_,data:c(v).reservas,loading:c(v).loading},{"cell-huesped":o(({item:t})=>[r(l(t?.huesped?.nombre)+" "+l(t?.huesped?.apellido),1)]),"cell-hotel":o(({item:t})=>[r(l(t?.hotel?.nombre),1)]),"cell-fechas":o(({item:t})=>[a("div",ee,[a("div",null,"ðŸ“… "+l(N(t?.fecha_entrada)),1),a("div",null,"ðŸ“… "+l(N(t?.fecha_salida)),1)])]),"cell-total":o(({item:t})=>[r(l(I(t?.total)),1)]),"cell-estado":o(({item:t})=>[a("span",{class:j(["px-3 py-1 rounded-full text-xs font-semibold",M(t?.estado)])},l(t?.estado),3)]),actions:o(({item:t})=>[t?(d(),u("div",te,[a("button",{onClick:k=>D(t.id),class:"text-blue-600 hover:text-blue-800",title:"Ver detalles"}," ðŸ‘ï¸ ",8,ae),t?.estado==="CONFIRMADA"&&c(g).hasPermission("checkin")?(d(),u("button",{key:0,onClick:k=>O(t),class:"text-green-600 hover:text-green-800",title:"Check-in"}," âœ… ",8,se)):p("",!0),t?.estado==="EN_PROCESO"&&c(g).hasPermission("checkout")?(d(),u("button",{key:1,onClick:k=>S(t),class:"text-purple-600 hover:text-purple-800",title:"Check-out"}," ðŸšª ",8,oe)):p("",!0),["PENDIENTE","CONFIRMADA"].includes(t?.estado)&&c(g).hasPermission("cancelar_reservas")?(d(),u("button",{key:2,onClick:k=>P(t),class:"text-red-600 hover:text-red-800",title:"Cancelar"}," âŒ ",8,re)):p("",!0)])):p("",!0)]),_:1},8,["data","loading"]),f(K,{show:m.value,onClose:e[5]||(e[5]=t=>m.value=!1),title:"Cancelar Reserva"},{footer:o(()=>[f(y,{variant:"secondary",onClick:e[4]||(e[4]=t=>m.value=!1)},{default:o(()=>[...e[16]||(e[16]=[r("No",-1)])]),_:1}),f(y,{variant:"danger",onClick:$,loading:h.value},{default:o(()=>[...e[17]||(e[17]=[r("SÃ­, Cancelar",-1)])]),_:1},8,["loading"])]),default:o(()=>[a("p",le,[e[14]||(e[14]=r(" Â¿EstÃ¡s seguro de cancelar la reserva de ",-1)),a("strong",null,l(C.value?.huesped?.nombre),1),e[15]||(e[15]=r("? ",-1))]),e[18]||(e[18]=a("p",{class:"text-sm text-gray-500 mt-2"},"Las habitaciones quedarÃ¡n disponibles nuevamente.",-1))]),_:1},8,["show"])]))}};export{me as default};
