import{r as u,h as F,c as d,a as e,d as w,e as b,p as E,F as C,A,v as D,i as N,m as c,t as s,H as T,o as n,s as L,n as P}from"./index-CTzTmT_K.js";import{_ as R}from"./Table-fkUJsl3I.js";const B={class:"p-6"},I={class:"bg-white rounded-lg shadow p-4 mb-6"},$={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},z=["value"],O={class:"bg-white rounded-lg shadow overflow-hidden"},H={class:"flex items-center"},J={class:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-bold mr-2"},q={class:"text-sm font-mono text-gray-600"},G=["onClick"],K={key:0,class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between"},Q={class:"text-sm text-gray-700"},W={class:"flex gap-2"},X=["disabled"],Y=["disabled"],Z={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ee={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},te={class:"p-6"},ae={class:"grid grid-cols-2 gap-4 mb-6"},se={class:"font-medium"},le={class:"font-medium"},oe={class:"font-medium"},re={class:"font-medium"},ie={key:0,class:"space-y-4"},de={class:"font-medium text-gray-600"},ne={class:"text-red-600 break-all bg-red-50 p-1 rounded"},ue={class:"text-green-600 break-all bg-green-50 p-1 rounded"},ce={key:1,class:"space-y-4"},ge={class:"font-semibold text-gray-800 border-b pb-2"},me={class:"bg-gray-50 p-4 rounded-lg overflow-x-auto"},be={class:"text-xs"},ye={__name:"Index",setup(ve){const v=u(!1),p=u([]),x=u([]),r=u({current_page:1,last_page:1,total:0}),i=u({user_id:"",accion:"",modelo:"",fecha_inicio:"",fecha_fin:""}),o=u({visible:!1,item:null}),V=[{key:"created_at",label:"Fecha",sortable:!0},{key:"user",label:"Usuario",sortable:!1},{key:"accion",label:"Acción",sortable:!0},{key:"modelo",label:"Modelo",sortable:!0},{key:"detalles",label:"Detalles",sortable:!1}],g=async(l=1)=>{v.value=!0;try{const t={page:l,...i.value},a=await T.get("/api/auditoria",{params:t});p.value=a.data.data.data,r.value={current_page:a.data.data.current_page,last_page:a.data.data.last_page,from:a.data.data.from,to:a.data.data.to,total:a.data.data.total}}catch(t){console.error("Error cargando auditoría:",t)}finally{v.value=!1}},U=async()=>{try{const l=await T.get("/api/users");x.value=l.data}catch{}},M=()=>g(1),S=()=>{i.value={user_id:"",accion:"",modelo:"",fecha_inicio:"",fecha_fin:""},g(1)},y=l=>g(l),j=l=>{o.value={visible:!0,item:l}},f=()=>{o.value={visible:!1,item:null}},_=l=>l?new Date(l).toLocaleString("es-BO"):"-",h=l=>l.replace("App\\Models\\",""),k=l=>l===null?"null":typeof l=="boolean"?l?"Sí":"No":l;return F(()=>{g(),U()}),(l,t)=>(n(),d("div",B,[t[18]||(t[18]=e("div",{class:"flex justify-between items-center mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-800"},"Auditoría del Sistema")],-1)),e("div",I,[e("div",$,[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>i.value.user_id=a),class:"w-full border border-gray-300 rounded-lg px-3 py-2"},[t[6]||(t[6]=e("option",{value:""},"Todos",-1)),(n(!0),d(C,null,A(x.value,a=>(n(),d("option",{key:a.id,value:a.id},s(a.name),9,z))),128))],512),[[E,i.value.user_id]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Acción",-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>i.value.accion=a),class:"w-full border border-gray-300 rounded-lg px-3 py-2"},[...t[8]||(t[8]=[e("option",{value:""},"Todas",-1),e("option",{value:"CREATE"},"Creación",-1),e("option",{value:"UPDATE"},"Edición",-1),e("option",{value:"DELETE"},"Eliminación",-1)])],512),[[E,i.value.accion]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Modelo",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>i.value.modelo=a),placeholder:"Ej. Reserva",class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,512),[[D,i.value.modelo]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Inicio",-1)),b(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=a=>i.value.fecha_inicio=a),class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,512),[[D,i.value.fecha_inicio]])])]),e("div",{class:"mt-4 flex justify-end gap-2"},[e("button",{onClick:S,class:"px-4 py-2 text-gray-600 hover:text-gray-800"}," Limpiar "),e("button",{onClick:M,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"}," Filtrar ")])]),e("div",O,[N(R,{columns:V,data:p.value,loading:v.value},{"cell-user":c(({item:a})=>[e("div",H,[e("div",J,s(a.user?.name?.charAt(0)||"?"),1),e("span",null,s(a.user?.name||"Sistema"),1)])]),"cell-accion":c(({item:a})=>[e("span",{class:P(["px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":a.accion==="CREATE","bg-blue-100 text-blue-800":a.accion==="UPDATE","bg-red-100 text-red-800":a.accion==="DELETE"}])},s(a.accion),3)]),"cell-modelo":c(({item:a})=>[e("span",q,s(h(a.modelo))+" #"+s(a.modelo_id),1)]),"cell-created_at":c(({item:a})=>[L(s(_(a.created_at)),1)]),"cell-detalles":c(({item:a})=>[e("button",{onClick:m=>j(a),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Ver Cambios ",8,G)]),_:1},8,["data","loading"]),r.value.last_page>1?(n(),d("div",K,[e("div",Q," Mostrando "+s(r.value.from)+" a "+s(r.value.to)+" de "+s(r.value.total)+" registros ",1),e("div",W,[e("button",{onClick:t[4]||(t[4]=a=>y(r.value.current_page-1)),disabled:r.value.current_page===1,class:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Anterior ",8,X),e("button",{onClick:t[5]||(t[5]=a=>y(r.value.current_page+1)),disabled:r.value.current_page===r.value.last_page,class:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50"}," Siguiente ",8,Y)])])):w("",!0)]),o.value.visible?(n(),d("div",Z,[e("div",ee,[e("div",{class:"p-6 border-b border-gray-200 flex justify-between items-center"},[t[12]||(t[12]=e("h3",{class:"text-lg font-bold text-gray-900"},"Detalles del Cambio",-1)),e("button",{onClick:f,class:"text-gray-400 hover:text-gray-600 text-2xl"},"×")]),e("div",te,[e("div",ae,[e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-500"},"Usuario",-1)),e("p",se,s(o.value.item?.user?.name||"Sistema"),1)]),e("div",null,[t[14]||(t[14]=e("p",{class:"text-sm text-gray-500"},"Fecha",-1)),e("p",le,s(_(o.value.item?.created_at)),1)]),e("div",null,[t[15]||(t[15]=e("p",{class:"text-sm text-gray-500"},"Modelo",-1)),e("p",oe,s(h(o.value.item?.modelo))+" #"+s(o.value.item?.modelo_id),1)]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-500"},"IP",-1)),e("p",re,s(o.value.item?.ip_address),1)])]),o.value.item?.accion==="UPDATE"?(n(),d("div",ie,[t[17]||(t[17]=e("h4",{class:"font-semibold text-gray-800 border-b pb-2"},"Cambios Realizados",-1)),(n(!0),d(C,null,A(o.value.item.valores_nuevos,(a,m)=>(n(),d("div",{key:m,class:"grid grid-cols-3 gap-2 text-sm border-b border-gray-100 py-2"},[e("div",de,s(m),1),e("div",ne,s(k(o.value.item.valores_antiguos?.[m])),1),e("div",ue,s(k(a)),1)]))),128))])):(n(),d("div",ce,[e("h4",ge,s(o.value.item?.accion==="CREATE"?"Valores Iniciales":"Valores Eliminados"),1),e("div",me,[e("pre",be,s(JSON.stringify(o.value.item?.valores_nuevos||o.value.item?.valores_antiguos,null,2)),1)])]))]),e("div",{class:"p-6 border-t border-gray-200 flex justify-end"},[e("button",{onClick:f,class:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-800"}," Cerrar ")])])])):w("",!0)]))}};export{ye as default};
