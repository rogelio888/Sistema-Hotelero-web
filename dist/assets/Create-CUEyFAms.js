import{r as v,g as f,h as A,c as d,a,i as _,m as h,y as M,w as D,d as b,e as m,p as O,F as w,A as E,t as r,n as R,v as C,H as g,q,o as u,s as k,I as B}from"./index-CTzTmT_K.js";const I={class:"p-6"},$={class:"flex items-center mb-6"},H={class:"max-w-2xl bg-white rounded-lg shadow p-6"},U={class:"mb-4"},j=["value"],z={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg"},G={class:"grid grid-cols-2 gap-2 text-sm"},J={class:"font-medium ml-2"},L={class:"font-medium ml-2"},Y={class:"font-medium ml-2"},K={class:"font-medium ml-2"},Q={class:"col-span-2"},W={class:"mb-4"},X={class:"grid grid-cols-3 gap-3"},Z=["value"],ee={class:"text-sm font-medium"},ae={class:"mb-4"},te=["max"],se={key:0,class:"text-xs text-red-600 mt-1"},oe={key:1,class:"text-xs text-gray-500 mt-1"},re={class:"mb-6"},le={class:"flex gap-3"},ne=["disabled"],ie={__name:"Create",setup(de){const P=q(),x=v([]),l=v(null),c=v(0),t=v({id_reserva:"",tipo_pago:"",monto:0,fecha:(()=>{const o=new Date,e=o.getFullYear(),p=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");return`${e}-${p}-${s}`})()}),S=[{value:"EFECTIVO",label:"ðŸ’µ Efectivo"},{value:"TARJETA",label:"ðŸ’³ Tarjeta"},{value:"TRANSFERENCIA",label:"ðŸ¦ Transferencia"}],n=f(()=>l.value?parseFloat(l.value.total||0)-c.value:0),y=f(()=>t.value.id_reserva&&t.value.tipo_pago&&t.value.monto>0&&t.value.monto<=n.value&&t.value.fecha),F=async()=>{try{const o=await g.get("/api/reservas",{params:{estado:"CONFIRMADA,EN_PROCESO"}});x.value=o.data.data.filter(e=>e.estado==="CONFIRMADA"||e.estado==="EN_PROCESO")}catch(o){console.error("Error al cargar reservas:",o),alert("Error al cargar las reservas")}},N=async()=>{if(!t.value.id_reserva){l.value=null;return}try{const o=await g.get(`/api/reservas/${t.value.id_reserva}`);l.value=o.data.data;const e=await g.get(`/api/pagos/reserva/${t.value.id_reserva}`);c.value=parseFloat(e.data.total_pagado||0)}catch(o){console.error("Error al cargar detalles de reserva:",o),alert("Error al cargar los detalles de la reserva")}},T=async()=>{if(!y.value){alert("Por favor complete todos los campos correctamente");return}try{await g.post("/api/pagos",t.value),alert("Pago registrado exitosamente"),P.push("/pagos")}catch(o){console.error("Error al guardar pago:",o),alert(o.response?.data?.message||"Error al registrar el pago")}},i=o=>"Bs. "+parseFloat(o||0).toFixed(2);return A(()=>{F()}),(o,e)=>{const p=M("router-link");return u(),d("div",I,[a("div",$,[_(p,{to:"/pagos",class:"text-gray-600 hover:text-gray-800 mr-4"},{default:h(()=>[...e[4]||(e[4]=[k(" â† Volver ",-1)])]),_:1}),e[5]||(e[5]=a("h1",{class:"text-2xl font-bold text-gray-800"},"Registrar Pago",-1))]),a("div",H,[a("form",{onSubmit:D(T,["prevent"])},[a("div",U,[e[7]||(e[7]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Reserva * ",-1)),m(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.id_reserva=s),onChange:N,class:"w-full border border-gray-300 rounded-lg px-3 py-2",required:""},[e[6]||(e[6]=a("option",{value:""},"Seleccione una reserva",-1)),(u(!0),d(w,null,E(x.value,s=>(u(),d("option",{key:s.id,value:s.id},r(s.huesped?.nombre)+" - Hab. "+r(s.habitacion?.numero)+" ("+r(s.estado)+") ",9,j))),128))],544),[[O,t.value.id_reserva]])]),l.value?(u(),d("div",z,[e[13]||(e[13]=a("h3",{class:"font-semibold text-gray-900 mb-2"},"Detalles de la Reserva",-1)),a("div",G,[a("div",null,[e[8]||(e[8]=a("span",{class:"text-gray-600"},"HuÃ©sped:",-1)),a("span",J,r(l.value.huesped?.nombre),1)]),a("div",null,[e[9]||(e[9]=a("span",{class:"text-gray-600"},"HabitaciÃ³n:",-1)),a("span",L,r(l.value.habitacion?.numero),1)]),a("div",null,[e[10]||(e[10]=a("span",{class:"text-gray-600"},"Total:",-1)),a("span",Y,r(i(l.value.total)),1)]),a("div",null,[e[11]||(e[11]=a("span",{class:"text-gray-600"},"Pagado:",-1)),a("span",K,r(i(c.value)),1)]),a("div",Q,[e[12]||(e[12]=a("span",{class:"text-gray-600"},"Saldo Pendiente:",-1)),a("span",{class:R(["font-bold text-lg ml-2",n.value>0?"text-red-600":"text-green-600"])},r(i(n.value)),3)])])])):b("",!0),a("div",W,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Tipo de Pago * ",-1)),a("div",X,[(u(),d(w,null,E(S,s=>a("label",{key:s.value,class:R(["flex items-center justify-center p-3 border-2 rounded-lg cursor-pointer transition-all",t.value.tipo_pago===s.value?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"])},[m(a("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=V=>t.value.tipo_pago=V),value:s.value,class:"sr-only",required:""},null,8,Z),[[B,t.value.tipo_pago]]),a("span",ee,r(s.label),1)],2)),64))])]),a("div",ae,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Monto (Bs.) * ",-1)),m(a("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=s=>t.value.monto=s),step:"0.01",min:"0.01",max:n.value,class:"w-full border border-gray-300 rounded-lg px-3 py-2",placeholder:"0.00",required:""},null,8,te),[[C,t.value.monto,void 0,{number:!0}]]),t.value.monto>n.value?(u(),d("p",se," El monto no puede exceder el saldo pendiente ")):b("",!0),t.value.monto>0&&t.value.monto<=n.value?(u(),d("p",oe," Saldo restante despuÃ©s del pago: "+r(i(n.value-t.value.monto)),1)):b("",!0)]),a("div",re,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Fecha * ",-1)),m(a("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>t.value.fecha=s),class:"w-full border border-gray-300 rounded-lg px-3 py-2",required:""},null,512),[[C,t.value.fecha]])]),a("div",le,[a("button",{type:"submit",disabled:!y.value,class:"flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Registrar Pago ",8,ne),_(p,{to:"/pagos",class:"flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg text-center transition-colors"},{default:h(()=>[...e[17]||(e[17]=[k(" Cancelar ",-1)])]),_:1})])],32)])])}}};export{ie as default};
