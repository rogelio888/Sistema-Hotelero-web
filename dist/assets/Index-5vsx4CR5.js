import{r as d,g as M,h as V,c as r,a as s,i as v,F as b,A as x,m,j as p,o as l,t as n,d as j,e as A,G,s as h}from"./index-CTzTmT_K.js";import{_ as w}from"./Button-Dd-4xSWI.js";import{M as N}from"./Modal-ClueKbjA.js";const B={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},S={class:"flex items-start justify-between mb-4"},z={class:"text-xl font-bold text-gray-800"},D={class:"text-sm text-gray-600 mt-1"},F=["onClick"],I={class:"pt-4 border-t border-gray-200"},R={class:"text-2xl font-bold text-blue-600"},U={key:0},L={class:"mb-6 p-4 bg-gray-50 rounded-lg"},O={class:"font-bold text-lg"},T={class:"text-sm text-gray-600"},q={class:"space-y-6 max-h-96 overflow-y-auto"},H={class:"font-bold text-gray-800 mb-3 sticky top-0 bg-white py-2"},J={class:"grid grid-cols-2 gap-2"},K=["value"],Q={class:"text-sm"},W={class:"mt-4 p-4 bg-blue-50 rounded-lg"},X={class:"text-sm text-blue-800"},ts={__name:"Index",setup(Y){const f=d([]),y=d([]),i=d(null),c=d([]),u=d(!1),g=d(!1),k=M(()=>{const t={};return y.value.forEach(e=>{const o=e.nombre.split("_"),a=o.length>1?o[o.length-1]:"otros";t[a]||(t[a]={nombre:a.charAt(0).toUpperCase()+a.slice(1),permisos:[]}),t[a].permisos.push(e)}),Object.values(t)}),_=async()=>{try{const t=await p.get("/roles");t.data.success&&(f.value=t.data.data)}catch(t){console.error("Error al cargar roles:",t)}},C=async()=>{try{const t=await p.get("/permisos");t.data.success&&(y.value=t.data.data)}catch(t){console.error("Error al cargar permisos:",t)}},P=async t=>{try{const e=await p.get(`/roles/${t.id}`);e.data.success&&(i.value=e.data.data,c.value=i.value.permisos.map(o=>o.id),u.value=!0)}catch{alert("Error al cargar rol")}},E=async()=>{g.value=!0;try{await p.post(`/roles/${i.value.id}/asignar-permisos`,{permisos:c.value}),u.value=!1,await _(),alert("Permisos actualizados exitosamente")}catch{alert("Error al guardar permisos")}finally{g.value=!1}};return V(()=>{_(),C()}),(t,e)=>(l(),r("div",null,[e[7]||(e[7]=s("div",{class:"flex items-center justify-between mb-6"},[s("div",null,[s("h1",{class:"text-3xl font-bold text-gray-800"},"Roles y Permisos"),s("p",{class:"text-gray-600 mt-1"},"Administra roles y sus permisos")])],-1)),s("div",B,[(l(!0),r(b,null,x(f.value,o=>(l(),r("div",{key:o.id,class:"bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow"},[s("div",S,[s("div",null,[s("h3",z,n(o.nombre),1),s("p",D,n(o.descripcion),1)]),s("button",{onClick:a=>P(o),class:"text-blue-600 hover:text-blue-800",title:"Gestionar permisos"}," ⚙️ ",8,F)]),s("div",I,[e[3]||(e[3]=s("p",{class:"text-sm text-gray-600 mb-2"},"Permisos asignados:",-1)),s("p",R,n(o.permisos?.length||0),1)])]))),128))]),v(N,{show:u.value,onClose:e[2]||(e[2]=o=>u.value=!1),title:"Gestionar Permisos",size:"xl"},{footer:m(()=>[v(w,{variant:"secondary",onClick:e[1]||(e[1]=o=>u.value=!1)},{default:m(()=>[...e[5]||(e[5]=[h("Cancelar",-1)])]),_:1}),v(w,{onClick:E,loading:g.value},{default:m(()=>[...e[6]||(e[6]=[h("Guardar Cambios",-1)])]),_:1},8,["loading"])]),default:m(()=>[i.value?(l(),r("div",U,[s("div",L,[s("h3",O,n(i.value.nombre),1),s("p",T,n(i.value.descripcion),1)]),s("div",q,[(l(!0),r(b,null,x(k.value,o=>(l(),r("div",{key:o.nombre},[s("h4",H,n(o.nombre),1),s("div",J,[(l(!0),r(b,null,x(o.permisos,a=>(l(),r("label",{key:a.id,class:"flex items-center p-3 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer"},[A(s("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":e[0]||(e[0]=$=>c.value=$),class:"mr-3 w-4 h-4 text-blue-600"},null,8,K),[[G,c.value]]),s("span",Q,n(a.descripcion||a.nombre),1)]))),128))])]))),128))]),s("div",W,[s("p",X,[s("strong",null,n(c.value.length),1),e[4]||(e[4]=h(" permisos seleccionados ",-1))])])])):j("",!0)]),_:1},8,["show"])]))}};export{ts as default};
