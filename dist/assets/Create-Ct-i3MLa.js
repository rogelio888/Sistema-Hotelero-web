import{r as u,g as b,E as D,h as F,c as l,a as t,i as q,m as A,y as U,e as d,d as j,s as c,p as k,F as x,A as h,v as C,t as n,w as L,j as w,q as z,o as i,n as $,G}from"./index-CTzTmT_K.js";const P={class:"p-6"},H={class:"flex justify-between items-center mb-6"},Y=["value"],J={key:0,class:"text-sm text-red-500 mt-1"},K=["value"],Q={key:0,class:"bg-blue-50 p-4 rounded-lg border border-blue-100"},W={class:"grid grid-cols-2 sm:grid-cols-3 gap-2"},X=["value"],Z={class:"text-sm"},ee={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"flex items-center justify-end space-x-4 pt-4 border-t"},se=["disabled"],re={__name:"Create",setup(ae){const O=z(),v=u(!1),g=u(!1),m=u([]),f=u([]),o=u({id_reserva:"",id_servicio:"",cantidad:1,fecha:(()=>{const s=new Date,e=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");return`${e}-${r}-${a}`})(),fechas:[]}),M=b(()=>f.value.find(s=>s.id===o.value.id_servicio)),y=b(()=>m.value.find(s=>s.id===o.value.id_reserva)),p=b(()=>M.value?.frecuencia==="DIARIO"),S=b(()=>{if(!y.value)return[];const s=[];let e=new Date(y.value.fecha_entrada);e.setMinutes(e.getMinutes()+e.getTimezoneOffset());const r=new Date(y.value.fecha_salida);for(r.setMinutes(r.getMinutes()+r.getTimezoneOffset());e<r;)s.push({value:e.toISOString().split("T")[0],label:e.toLocaleDateString("es-BO",{day:"2-digit",month:"2-digit"})}),e.setDate(e.getDate()+1);return s});D(()=>o.value.id_reserva,()=>{o.value.fechas=[]}),D(p,s=>{s&&(o.value.cantidad=1)});const T=()=>{o.value.fechas=S.value.map(s=>s.value)},V=()=>{o.value.fechas=[]},R=()=>{o.value={id_reserva:"",id_servicio:"",cantidad:1,fecha:new Date().toISOString().split("T")[0],fechas:[]}},B=s=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB"}).format(s),_=s=>s?new Date(s).toLocaleDateString("es-BO",{day:"2-digit",month:"2-digit",year:"numeric"}):"",I=async()=>{g.value=!0;try{const[s,e]=await Promise.all([w.get("/reservas"),w.get("/servicios")]);m.value=s.data.data.filter(r=>["CONFIRMADA","EN_PROCESO"].includes(r.estado)),f.value=e.data.data.filter(r=>r.estado==="ACTIVO")}catch(s){console.error(s),alert("Error al cargar datos necesarios")}finally{g.value=!1}},N=async()=>{v.value=!0;try{const s={...o.value};p.value?delete s.fecha:delete s.fechas,await w.post("/consumos",s),alert("Consumo(s) registrado(s) exitosamente"),O.push("/consumos")}catch(s){console.error(s),alert(s.response?.data?.message||"Error al registrar consumo")}finally{v.value=!1}};return F(()=>{I()}),(s,e)=>{const r=U("router-link");return i(),l("div",P,[t("div",H,[e[6]||(e[6]=t("h1",{class:"text-2xl font-bold text-gray-800"},"Registrar Consumo",-1)),q(r,{to:"/consumos",class:"text-blue-600 hover:underline"},{default:A(()=>[...e[5]||(e[5]=[c(" â† Volver al listado ",-1)])]),_:1})]),t("form",{onSubmit:L(N,["prevent"]),class:"space-y-6 max-w-2xl bg-white p-6 rounded-lg shadow"},[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c("Reserva "),t("span",{class:"text-red-500"},"*")],-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.id_reserva=a),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"},[e[7]||(e[7]=t("option",{value:"",disabled:""},"Seleccione una reserva",-1)),(i(!0),l(x,null,h(m.value,a=>(i(),l("option",{key:a.id,value:a.id}," Hab. "+n(a.habitacion?.numero)+" - "+n(a.huesped?.nombre)+" "+n(a.huesped?.apellido)+" ("+n(_(a.fecha_entrada))+" - "+n(_(a.fecha_salida))+") ",9,Y))),128))],512),[[k,o.value.id_reserva]]),m.value.length===0&&!g.value?(i(),l("p",J," No hay reservas activas disponibles. ")):j("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c("Servicio "),t("span",{class:"text-red-500"},"*")],-1)),d(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.id_servicio=a),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"},[e[9]||(e[9]=t("option",{value:"",disabled:""},"Seleccione un servicio",-1)),(i(!0),l(x,null,h(f.value,a=>(i(),l("option",{key:a.id,value:a.id},n(a.nombre)+" - "+n(B(a.precio))+" ("+n(a.frecuencia)+") ",9,K))),128))],512),[[k,o.value.id_servicio]])]),p.value&&o.value.id_reserva?(i(),l("div",Q,[e[11]||(e[11]=t("h3",{class:"font-medium text-blue-800 mb-3"},"ðŸ“… Seleccionar dÃ­as para el servicio diario",-1)),t("div",{class:"flex justify-end mb-2 space-x-2"},[t("button",{type:"button",onClick:T,class:"text-xs text-blue-600 hover:underline"},"Seleccionar Todos"),t("button",{type:"button",onClick:V,class:"text-xs text-gray-600 hover:underline"},"Deseleccionar Todos")]),t("div",W,[(i(!0),l(x,null,h(S.value,a=>(i(),l("label",{key:a.value,class:$(["flex items-center space-x-2 p-2 bg-white rounded border cursor-pointer hover:bg-gray-50",{"border-blue-500 ring-1 ring-blue-500":o.value.fechas.includes(a.value)}])},[d(t("input",{type:"checkbox",value:a.value,"onUpdate:modelValue":e[2]||(e[2]=E=>o.value.fechas=E),class:"rounded text-blue-600 focus:ring-blue-500"},null,8,X),[[G,o.value.fechas]]),t("span",Z,n(a.label),1)],2))),128))]),e[12]||(e[12]=t("p",{class:"text-sm text-gray-500 mt-2"}," Se registrarÃ¡ un consumo por cada dÃ­a seleccionado. ",-1))])):(i(),l("div",ee,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c("Cantidad "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.cantidad=a),type:"number",min:"1",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"},null,512),[[C,o.value.cantidad,void 0,{number:!0}]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c("Fecha "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.fecha=a),type:"date",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"},null,512),[[C,o.value.fecha]])])])),t("div",te,[t("button",{type:"button",onClick:R,class:"text-gray-600 hover:text-gray-800 px-4 py-2"}," Limpiar "),t("button",{type:"submit",disabled:v.value||p.value&&o.value.fechas.length===0,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},n(v.value?"Guardando...":"Registrar Consumo"),9,se)])],32)])}}};export{re as default};
