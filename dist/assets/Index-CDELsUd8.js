import{r as v,h as U,c as u,a as t,d as b,i as E,m as c,y as j,t as n,e as x,p as M,v as w,s as y,H as O,q as $,o as g,n as F}from"./index-CTzTmT_K.js";import{_ as H}from"./Table-fkUJsl3I.js";const L={class:"p-6"},B={class:"flex justify-between items-center mb-6"},q={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},Y={class:"bg-white rounded-lg shadow p-4"},z={class:"text-2xl font-bold text-green-600"},J={class:"bg-white rounded-lg shadow p-4"},W={class:"text-2xl font-bold text-blue-600"},G={class:"bg-white rounded-lg shadow p-4"},K={class:"text-2xl font-bold text-red-600"},Q={class:"bg-white rounded-lg shadow p-4 mb-6"},X={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Z={class:"bg-white rounded-lg shadow overflow-hidden"},ee={class:"font-medium text-gray-900"},te={class:"text-sm text-gray-500"},ae={key:0,class:"flex items-center justify-end space-x-2"},oe=["onClick"],se=["onClick"],le={key:2,class:"text-sm text-gray-400 italic"},re={key:0,class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between"},ne={class:"text-sm text-gray-700"},de={class:"flex gap-2"},ie=["disabled"],ue=["disabled"],ce={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ge={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},pe={class:"text-sm text-gray-600 mb-4"},ve={class:"mb-4"},be={class:"flex gap-2 justify-end"},fe=["disabled"],_e={__name:"Index",setup(me){$();const h=v(!1),f=v([]),d=v({current_page:1,last_page:1,from:0,to:0,total:0}),p=v({totalHoy:0,totalMes:0,anuladosMes:0}),s=v({tipo_pago:"",estado:"",fecha_inicio:"",fecha_fin:""}),i=v({visible:!1,pago:null,motivo:""}),D=[{key:"id",label:"ID",sortable:!0},{key:"reserva",label:"Reserva",sortable:!1},{key:"tipo_pago",label:"Tipo de Pago",sortable:!0},{key:"monto",label:"Monto",sortable:!0},{key:"fecha",label:"Fecha",sortable:!0},{key:"estado",label:"Estado",sortable:!0}],m=async(o=1)=>{h.value=!0;try{const e={page:o};s.value.tipo_pago&&(e.tipo_pago=s.value.tipo_pago),s.value.estado&&s.value.estado!=="TODOS"&&(e.estado=s.value.estado),s.value.estado==="TODOS"&&(e.incluir_anulados=!0),s.value.fecha_inicio&&(e.fecha_inicio=s.value.fecha_inicio),s.value.fecha_fin&&(e.fecha_fin=s.value.fecha_fin);const l=await O.get("/api/pagos",{params:e});if(!l.data||!l.data.data)throw new Error("Estructura de respuesta inválida");f.value=l.data.data.data||[],d.value={current_page:l.data.data.current_page||1,last_page:l.data.data.last_page||1,from:l.data.data.from||0,to:l.data.data.to||0,total:l.data.data.total||0},V()}catch(e){console.error("Error al cargar pagos:",e),alert("Error al cargar los pagos")}finally{h.value=!1}},V=()=>{const o=new Date().toISOString().split("T")[0],e=new Date().getMonth(),l=new Date().getFullYear();p.value.totalHoy=f.value.filter(a=>a.estado==="ACTIVO"&&a.fecha.startsWith(o)).reduce((a,r)=>a+parseFloat(r.monto),0),p.value.totalMes=f.value.filter(a=>{const r=new Date(a.fecha);return a.estado==="ACTIVO"&&r.getMonth()===e&&r.getFullYear()===l}).reduce((a,r)=>a+parseFloat(r.monto),0),p.value.anuladosMes=f.value.filter(a=>{if(a.estado!=="ANULADO"||!a.fecha_anulacion)return!1;const r=new Date(a.fecha_anulacion);return r.getMonth()===e&&r.getFullYear()===l}).length},A=o=>{o>=1&&o<=d.value.last_page&&m(o)},N=()=>{m(1)},I=()=>{s.value={tipo_pago:"",estado:"",fecha_inicio:"",fecha_fin:""},m(1)},k=o=>["CONFIRMADA","EN_PROCESO"].includes(o.reserva?.estado),P=o=>{i.value={visible:!0,pago:o,motivo:""}},C=()=>{i.value={visible:!1,pago:null,motivo:""}},R=async()=>{if(i.value.motivo.length<10){alert("El motivo debe tener al menos 10 caracteres");return}try{await O.post(`/api/pagos/${i.value.pago.id}/anular`,{motivo_anulacion:i.value.motivo}),alert("Pago anulado exitosamente"),C(),m(d.value.current_page)}catch(o){console.error("Error al anular pago:",o),alert(o.response?.data?.message||"Error al anular el pago")}},S=o=>{const e=T(o.fecha_anulacion);alert(`Motivo de anulación:

${o.motivo_anulacion}

Fecha de anulación: ${e}`)},_=o=>"Bs. "+parseFloat(o||0).toFixed(2),T=o=>{if(!o)return"N/A";const e=o.toString().substring(0,10),[l,a,r]=e.split("-");return!l||!a||!r?"Fecha Inválida":new Date(l,a-1,r).toLocaleDateString("es-BO")};return U(()=>{m()}),(o,e)=>{const l=j("router-link");return g(),u("div",L,[t("div",B,[e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-gray-800"},"Pagos",-1)),E(l,{to:"/pagos/crear",class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors"},{default:c(()=>[...e[7]||(e[7]=[y(" + Registrar Pago ",-1)])]),_:1})]),t("div",q,[t("div",Y,[e[9]||(e[9]=t("p",{class:"text-sm text-gray-600"},"Total Cobrado Hoy",-1)),t("p",z,n(_(p.value.totalHoy)),1)]),t("div",J,[e[10]||(e[10]=t("p",{class:"text-sm text-gray-600"},"Total Cobrado Este Mes",-1)),t("p",W,n(_(p.value.totalMes)),1)]),t("div",G,[e[11]||(e[11]=t("p",{class:"text-sm text-gray-600"},"Pagos Anulados Este Mes",-1)),t("p",K,n(p.value.anuladosMes),1)])]),t("div",Q,[t("div",X,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Pago",-1)),x(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.tipo_pago=a),class:"w-full border border-gray-300 rounded-lg px-3 py-2"},[...e[12]||(e[12]=[t("option",{value:""},"Todos",-1),t("option",{value:"EFECTIVO"},"Efectivo",-1),t("option",{value:"TARJETA"},"Tarjeta",-1),t("option",{value:"TRANSFERENCIA"},"Transferencia",-1)])],512),[[M,s.value.tipo_pago]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),x(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.estado=a),class:"w-full border border-gray-300 rounded-lg px-3 py-2"},[...e[14]||(e[14]=[t("option",{value:""},"Activos",-1),t("option",{value:"ACTIVO"},"Activo",-1),t("option",{value:"ANULADO"},"Anulado",-1),t("option",{value:"TODOS"},"Todos",-1)])],512),[[M,s.value.estado]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Inicio",-1)),x(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.fecha_inicio=a),class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,512),[[w,s.value.fecha_inicio]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Fin",-1)),x(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=a=>s.value.fecha_fin=a),class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,512),[[w,s.value.fecha_fin]])])]),t("div",{class:"mt-4 flex gap-2"},[t("button",{onClick:N,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"}," Filtrar "),t("button",{onClick:I,class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"}," Limpiar ")])]),t("div",Z,[E(H,{columns:D,data:f.value,loading:h.value},{"cell-reserva":c(({item:a})=>[t("div",null,[t("p",ee,n(a.reserva?.huesped?.nombre||"N/A"),1),t("p",te,"Hab. "+n(a.reserva?.habitacion?.[0]?.numero||"N/A"),1)])]),"cell-tipo_pago":c(({item:a})=>[t("span",{class:F(["px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":a.tipo_pago==="EFECTIVO","bg-blue-100 text-blue-800":a.tipo_pago==="TARJETA","bg-purple-100 text-purple-800":a.tipo_pago==="TRANSFERENCIA"}])},n(a.tipo_pago),3)]),"cell-monto":c(({item:a})=>[y(n(_(a.monto)),1)]),"cell-fecha":c(({item:a})=>[y(n(T(a.fecha)),1)]),"cell-estado":c(({item:a})=>[t("span",{class:F(["px-2 py-1 text-xs font-semibold rounded-full",{"bg-green-100 text-green-800":a.estado==="ACTIVO","bg-red-100 text-red-800":a.estado==="ANULADO"}])},n(a.estado),3)]),actions:c(({item:a})=>[a?(g(),u("div",ae,[a.estado==="ACTIVO"&&a.reserva&&k(a)?(g(),u("button",{key:0,onClick:r=>P(a),class:"text-red-500 hover:text-red-600 p-1",title:"Anular pago"}," ⊗ ",8,oe)):b("",!0),a.estado==="ANULADO"?(g(),u("button",{key:1,onClick:r=>S(a),class:"text-blue-500 hover:text-blue-600 p-1",title:"Ver motivo de anulación"}," ℹ️ ",8,se)):b("",!0),a.estado==="ACTIVO"&&a.reserva&&!k(a)?(g(),u("span",le," Reserva "+n(a.reserva.estado),1)):b("",!0)])):b("",!0)]),_:1},8,["data","loading"]),d.value.last_page>1?(g(),u("div",re,[t("div",ne," Mostrando "+n(d.value.from)+" a "+n(d.value.to)+" de "+n(d.value.total)+" resultados ",1),t("div",de,[t("button",{onClick:e[4]||(e[4]=a=>A(d.value.current_page-1)),disabled:d.value.current_page===1,class:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,ie),t("button",{onClick:e[5]||(e[5]=a=>A(d.value.current_page+1)),disabled:d.value.current_page===d.value.last_page,class:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,ue)])])):b("",!0)]),i.value.visible?(g(),u("div",ce,[t("div",ge,[e[22]||(e[22]=t("h3",{class:"text-lg font-bold text-gray-900 mb-4"},"Anular Pago",-1)),t("p",pe,[e[18]||(e[18]=y(" ¿Está seguro que desea anular este pago de ",-1)),t("strong",null,n(_(i.value.pago?.monto)),1),e[19]||(e[19]=y("? ",-1))]),t("div",ve,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Motivo de anulación *",-1)),x(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.motivo=a),rows:"3",class:"w-full border border-gray-300 rounded-lg px-3 py-2",placeholder:"Ej: Falla en máquina de tarjetas, error en monto, etc."},null,512),[[w,i.value.motivo]]),e[21]||(e[21]=t("p",{class:"text-xs text-gray-500 mt-1"},"Mínimo 10 caracteres",-1))]),t("div",be,[t("button",{onClick:C,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"}," Cancelar "),t("button",{onClick:R,disabled:i.value.motivo.length<10,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"}," Anular Pago ",8,fe)])])])):b("",!0)])}}};export{_e as default};
